{"ast":null,"code":"'use strict';\n\nvar KafkaBuffer = function (batchSize, batchAge) {\n  this._batch_size = batchSize;\n  this._batch_age = batchAge;\n  this._batch_age_timer = null;\n  this._buffer = null;\n};\n\nKafkaBuffer.prototype.addChunk = function (buffer, callback) {\n  if (this._buffer == null) {\n    this._buffer = Buffer.from(buffer);\n  } else {\n    this._buffer = Buffer.concat([this._buffer, buffer]);\n  }\n\n  if (typeof callback !== 'undefined' && callback != null) {\n    if (this._batch_size == null || this._batch_age == null || this._buffer && this._buffer.length > this._batch_size) {\n      callback();\n    } else {\n      this._setupTimer(callback);\n    }\n  }\n};\n\nKafkaBuffer.prototype._setupTimer = function (callback) {\n  var self = this;\n\n  if (this._batch_age_timer != null) {\n    clearTimeout(this._batch_age_timer);\n  }\n\n  this._batch_age_timer = setTimeout(function () {\n    if (self._buffer && self._buffer.length > 0) {\n      callback();\n    }\n  }, this._batch_age);\n};\n\nKafkaBuffer.prototype.getBatch = function () {\n  return this._buffer;\n};\n\nKafkaBuffer.prototype.truncateBatch = function () {\n  this._buffer = null;\n};\n\nmodule.exports = KafkaBuffer;","map":{"version":3,"sources":["/home/jerem/Bureau/Cours/IWA/stopcovid-front/node_modules/kafka-node/lib/batch/KafkaBuffer.js"],"names":["KafkaBuffer","batchSize","batchAge","_batch_size","_batch_age","_batch_age_timer","_buffer","prototype","addChunk","buffer","callback","Buffer","from","concat","length","_setupTimer","self","clearTimeout","setTimeout","getBatch","truncateBatch","module","exports"],"mappings":"AAAA;;AAEA,IAAIA,WAAW,GAAG,UAAUC,SAAV,EAAqBC,QAArB,EAA+B;AAC/C,OAAKC,WAAL,GAAmBF,SAAnB;AACA,OAAKG,UAAL,GAAkBF,QAAlB;AACA,OAAKG,gBAAL,GAAwB,IAAxB;AACA,OAAKC,OAAL,GAAe,IAAf;AACD,CALD;;AAOAN,WAAW,CAACO,SAAZ,CAAsBC,QAAtB,GAAiC,UAAUC,MAAV,EAAkBC,QAAlB,EAA4B;AAC3D,MAAI,KAAKJ,OAAL,IAAgB,IAApB,EAA0B;AACxB,SAAKA,OAAL,GAAeK,MAAM,CAACC,IAAP,CAAYH,MAAZ,CAAf;AACD,GAFD,MAEO;AACL,SAAKH,OAAL,GAAeK,MAAM,CAACE,MAAP,CAAc,CAAC,KAAKP,OAAN,EAAeG,MAAf,CAAd,CAAf;AACD;;AAED,MAAI,OAAOC,QAAP,KAAoB,WAApB,IAAmCA,QAAQ,IAAI,IAAnD,EAAyD;AACvD,QACE,KAAKP,WAAL,IAAoB,IAApB,IACA,KAAKC,UAAL,IAAmB,IADnB,IAEC,KAAKE,OAAL,IAAgB,KAAKA,OAAL,CAAaQ,MAAb,GAAsB,KAAKX,WAH9C,EAIE;AACAO,MAAAA,QAAQ;AACT,KAND,MAMO;AACL,WAAKK,WAAL,CAAiBL,QAAjB;AACD;AACF;AACF,CAlBD;;AAoBAV,WAAW,CAACO,SAAZ,CAAsBQ,WAAtB,GAAoC,UAAUL,QAAV,EAAoB;AACtD,MAAIM,IAAI,GAAG,IAAX;;AAEA,MAAI,KAAKX,gBAAL,IAAyB,IAA7B,EAAmC;AACjCY,IAAAA,YAAY,CAAC,KAAKZ,gBAAN,CAAZ;AACD;;AAED,OAAKA,gBAAL,GAAwBa,UAAU,CAAC,YAAY;AAC7C,QAAIF,IAAI,CAACV,OAAL,IAAgBU,IAAI,CAACV,OAAL,CAAaQ,MAAb,GAAsB,CAA1C,EAA6C;AAC3CJ,MAAAA,QAAQ;AACT;AACF,GAJiC,EAI/B,KAAKN,UAJ0B,CAAlC;AAKD,CAZD;;AAcAJ,WAAW,CAACO,SAAZ,CAAsBY,QAAtB,GAAiC,YAAY;AAC3C,SAAO,KAAKb,OAAZ;AACD,CAFD;;AAIAN,WAAW,CAACO,SAAZ,CAAsBa,aAAtB,GAAsC,YAAY;AAChD,OAAKd,OAAL,GAAe,IAAf;AACD,CAFD;;AAIAe,MAAM,CAACC,OAAP,GAAiBtB,WAAjB","sourcesContent":["'use strict';\n\nvar KafkaBuffer = function (batchSize, batchAge) {\n  this._batch_size = batchSize;\n  this._batch_age = batchAge;\n  this._batch_age_timer = null;\n  this._buffer = null;\n};\n\nKafkaBuffer.prototype.addChunk = function (buffer, callback) {\n  if (this._buffer == null) {\n    this._buffer = Buffer.from(buffer);\n  } else {\n    this._buffer = Buffer.concat([this._buffer, buffer]);\n  }\n\n  if (typeof callback !== 'undefined' && callback != null) {\n    if (\n      this._batch_size == null ||\n      this._batch_age == null ||\n      (this._buffer && this._buffer.length > this._batch_size)\n    ) {\n      callback();\n    } else {\n      this._setupTimer(callback);\n    }\n  }\n};\n\nKafkaBuffer.prototype._setupTimer = function (callback) {\n  var self = this;\n\n  if (this._batch_age_timer != null) {\n    clearTimeout(this._batch_age_timer);\n  }\n\n  this._batch_age_timer = setTimeout(function () {\n    if (self._buffer && self._buffer.length > 0) {\n      callback();\n    }\n  }, this._batch_age);\n};\n\nKafkaBuffer.prototype.getBatch = function () {\n  return this._buffer;\n};\n\nKafkaBuffer.prototype.truncateBatch = function () {\n  this._buffer = null;\n};\n\nmodule.exports = KafkaBuffer;\n"]},"metadata":{},"sourceType":"script"}